name: Sync Libis

on:
  schedule:
    # Daily schedule
    - cron: '0 3 * * *'

  workflow_dispatch: {}

jobs:
  copy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: 'copy'
          fetch-depth: 0
          
      - run: |
          git clone --depth=1 --branch=master https://github.com/libis/ca_tudelft_iiif
          pwd
          ls
          cp -a ca_tudelft_iiif/objects/. content/objects
          cp -a ca_tudelft_iiif/collections/. content/collections/lib-library
          git rm --cached -f ca_tudelft_iiif
          rm -r ca_tudelft_iiif
          git add .
          git diff-index --quiet HEAD || git commit -m "Automatic publish from github.com/libis/ca_tudelft_iiif"
        
      - run: git push origin master --force-with-lease
        continue-on-error: true
        

